<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
    xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
    xmlns:media="http://search.yahoo.com/mrss/"
>
    <channel>
        <!-- TODO validate -->
        <title>Windowbox</title>
        <atom:link href="{{ config['BASE_HREF'] }}{{ url_for('get_rss2') }}" rel="self" type="application/rss+xml" />
        <link>{{ config['BASE_HREF'] }}{{ url_for('get_index') }}</link>
        <description>Because moblogs aren&#39;t hip anymore.</description>
        <lastBuildDate>{{ items[0].get_created_date_rfc822() }}</lastBuildDate>
        <language>en-us</language>
        <sy:updatePeriod>hourly</sy:updatePeriod>
        <sy:updateFrequency>1</sy:updateFrequency>
        <generator>Windowbox</generator>
        <copyright>A contrivance by Scott Smitelli. &#169; 2004-{{ g.copyright_year }}.</copyright>
        <docs>http://cyber.law.harvard.edu/rss/rss.html</docs>
        <image>
            <url>{{ config['BASE_HREF'] }}{{ url_for('static', filename='images/windowbox-dark.png') }}</url>
            <title>Windowbox</title>
            <link>{{ config['BASE_HREF'] }}{{ url_for('get_index') }}</link>
        </image>

        {% for post in items %}
            <item>
                <title>{{ post.message }}</title>
                <guid isPermaLink="true">{{ config['BASE_HREF'] }}{{ url_for('get_post', post_id=post.id) }}</guid>
                <link>{{ config['BASE_HREF'] }}{{ url_for('get_post', post_id=post.id) }}</link>
                <pubDate>{{ post.get_created_date_rfc822() }}</pubDate>
                {% with attachment = post.get_attachment() %}
                    <description><![CDATA[
                        <p>
                            <a href="{{ config['BASE_HREF'] }}{{ url_for('get_post', post_id=post.id) }}">
                                <img src="{{ config['BASE_HREF'] }}{{ attachment.get_derivative_url(300, 300) }}" alt="{{ post.message }}" border="0" />
                            </a>
                        </p>
                    ]]></description>
                    <media:thumbnail url="{{ config['BASE_HREF'] }}{{ attachment.get_derivative_url(300, 300) }}" />
                    <media:content url="{{ config['BASE_HREF'] }}{{ attachment.get_derivative_url() }}" medium="image">
                        <media:title type="html">{{ post.message }}</media:title>
                    </media:content>
                {% endwith %}
            </item>
        {% endfor %}
    </channel>
</rss>
